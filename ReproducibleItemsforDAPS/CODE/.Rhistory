geom_smooth(aes(exp(log_vest_pm10), exp(log_msp_pm10)), color = "red1", method="lm", linetype = "dotdash")+
geom_point(aes(exp(log_vest_pm10), CDPHE_PM10_mean),color= "mediumblue", shape = 19) +
geom_smooth(aes(exp(log_vest_pm10), CDPHE_PM10_mean), color = "mediumblue", method ="lm", linetype= "solid") +
annotate(geom="text", x=75, y=125, label="CDPHE Mean vs. Wearable Monitor, \n corr = -0.15, p=0.21",
color="mediumblue", fontface="bold")+
annotate(geom="text", x=25, y=100, label="Stationary vs. Wearable Monitor, \n corr = 0.5, p=5.1e-6",
color="red1", fontface="bold")+
xlab(expression(paste("wearable" , ~ PM[10]))) +
ylab(expression(PM[10]))+
labs(title = "Relative Correlation with Wearable Monitor")+
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+
theme(plot.title=element_text( size=15)) +
theme(text = element_text(size = 15, color= "black"))
b <- ggplot(daps)
b +
geom_point(aes(exp(log_vest_pm10), exp(log_msp_pm10)), color = "red1", shape =17)+
geom_smooth(aes(exp(log_vest_pm10), exp(log_msp_pm10)), color = "red1", method="lm", linetype = "dotdash")+
geom_point(aes(exp(log_vest_pm10), CDPHE_PM10_mean),color= "mediumblue", shape = 19) +
geom_smooth(aes(exp(log_vest_pm10), CDPHE_PM10_mean), color = "mediumblue", method ="lm", linetype= "solid") +
annotate(geom="text", x=25, y=75, label="CDPHE Mean vs. Wearable Monitor, \n corr = -0.15, p=0.21",
color="mediumblue", fontface="bold")+
annotate(geom="text", x=25, y=100, label="Stationary vs. Wearable Monitor, \n corr = 0.5, p=5.1e-6",
color="red1", fontface="bold")+
xlab(expression(paste("wearable" , ~ PM[10]))) +
ylab(expression(PM[10]))+
labs(title = "Relative Correlation with Wearable Monitor")+
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+
theme(plot.title=element_text( size=15)) +
theme(text = element_text(size = 15, color= "black"))
b <- ggplot(daps)
b +
geom_point(aes(exp(log_vest_pm10), exp(log_msp_pm10)), color = "red1", shape =17)+
geom_smooth(aes(exp(log_vest_pm10), exp(log_msp_pm10)), color = "red1", method="lm", linetype = "dotdash")+
geom_point(aes(exp(log_vest_pm10), CDPHE_PM10_mean),color= "mediumblue", shape = 19) +
geom_smooth(aes(exp(log_vest_pm10), CDPHE_PM10_mean), color = "mediumblue", method ="lm", linetype= "solid") +
annotate(geom="text", x=25, y=75, label="CDPHE Mean vs. Wearable Monitor, \n corr = -0.15, p=0.21",
color="mediumblue", fontface="bold")+
annotate(geom="text", x=30, y=100, label="Stationary vs. Wearable Monitor, \n corr = 0.5, p=5.1e-6",
color="red1", fontface="bold")+
xlab(expression(paste("wearable" , ~ PM[10]))) +
ylab(expression(PM[10]))+
labs(title = "Relative Correlation with Wearable Monitor")+
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+
theme(plot.title=element_text( size=15)) +
theme(text = element_text(size = 15, color= "black"))
b <- ggplot(daps)
b +
geom_point(aes(log_vest_pm10, log_msp_pm10), color = "red1", shape =17)+
geom_smooth(aes(log_vest_pm10, log_msp_pm10), color = "red1", method="lm", linetype = "dotdash")+
geom_point(aes(log_vest_pm10, log(CDPHE_PM10_mean)),color= "mediumblue", shape = 19) +
geom_smooth(aes(log_vest_pm10, log(CDPHE_PM10_mean)), color = "mediumblue", method ="lm", linetype= "solid") +
annotate(geom="text", x=4, y=1.9, label="CDPHE vs. Wearable, \n corr = -9.45e-05, p=0.99",
color="mediumblue", fontface="bold")+
annotate(geom="text", x=4, y=5.2, label="Stationary vs. Wearable, \n corr = 0.58, p=8.18e-07",
color="red1", fontface="bold")+
xlab(expression(paste("wearable" , ~ log(PM[10])))) +
ylab(expression(log(PM[10])))+
labs(title = "Relative Correlation with Wearable Monitor")+
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+
theme(plot.title=element_text( size=15)) +
theme(text = element_text(size = 15, color= "black"))
b <- ggplot(daps)
b +
geom_point(aes(exp(log_vest_pm10), exp(log_msp_pm10)), color = "red1", shape =17)+
geom_smooth(aes(exp(log_vest_pm10), exp(log_msp_pm10)), color = "red1", method="lm", linetype = "dotdash")+
geom_point(aes(exp(log_vest_pm10), CDPHE_PM10_mean),color= "mediumblue", shape = 19) +
geom_smooth(aes(exp(log_vest_pm10), CDPHE_PM10_mean), color = "mediumblue", method ="lm", linetype= "solid") +
annotate(geom="text", x=25, y=75, label="CDPHE Mean vs. Wearable Monitor, \n corr = -9.45e-05, p=0.99",
color="mediumblue", fontface="bold")+
annotate(geom="text", x=30, y=100, label="Stationary vs. Wearable Monitor, \n corr = 0.58, p=8.18e-7",
color="red1", fontface="bold")+
xlab(expression(paste("wearable" , ~ PM[10]))) +
ylab(expression(PM[10]))+
labs(title = "Relative Correlation with Wearable Monitor")+
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+
theme(plot.title=element_text( size=15)) +
theme(text = element_text(size = 15, color= "black"))
b <- ggplot(daps)
b +
geom_point(aes(log_vest_pm10, log_FeNO_avg), color = "green3")+
geom_smooth(aes(log_vest_pm10, log_FeNO_avg), color = "green3")+
geom_point(aes(log_msp_pm10, log_FeNO_avg),color= "blue") +
geom_smooth(aes(log_msp_pm10, log_FeNO_avg), color = "blue") +
annotate(geom="text", x=4.5, y=1.5, label=expression(paste("log(FeNO) and Stationary" , ~ PM[10])),
color="blue", size =4)+
annotate(geom="text", x=2.5, y=5, label=expression(paste("log(FeNO) and Wearable" , ~ PM[10])),
color="darkgreen", size=4)+
xlab(expression(log(PM[10]))) +
ylab("log(FeNO)")+
labs(title = expression(paste("Exhaled Nitric Oxide and", ~ PM[10] ~ "Exposure")))+
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+
theme(plot.title=element_text( face="bold", size=16)) +
theme(text = element_text(size = 16, color= "black"))
b <- ggplot(daps)
b +
geom_point(aes(log_vest_pm10, log_FeNO_avg), color = "green3")+
geom_smooth(aes(log_vest_pm10, log_FeNO_avg), color = "green3")+
geom_point(aes(log_msp_pm10, log_FeNO_avg),color= "blue") +
geom_smooth(aes(log_msp_pm10, log_FeNO_avg), color = "blue") +
annotate(geom="text", x=4, y=1.5, label=expression(paste("log(FeNO) and Stationary" , ~ PM[10])),
color="blue", size =4)+
annotate(geom="text", x=2.5, y=5, label=expression(paste("log(FeNO) and Wearable" , ~ PM[10])),
color="darkgreen", size=4)+
xlab(expression(log(PM[10]))) +
ylab("log(FeNO)")+
labs(title = expression(paste("Exhaled Nitric Oxide and", ~ PM[10] ~ "Exposure")))+
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+
theme(plot.title=element_text( face="bold", size=16)) +
theme(text = element_text(size = 16, color= "black"))
#correlation of no2
no2corr <- rmcorr(id, log_vest_NO2, log_stat_NO2,daps)
no2corr
plot(no2corr, overall = TRUE, palette = pal, overall.col = 'black',lty = 3, xlab = expression(paste("Wearable" , ~ NO[2])), ylab = expression(paste("Stationary" , ~ NO[2])), main= expression(paste("Correlations between Stationary and Wearable" , ~ NO[2])))
text(3,1.4, expression(bold(rho)[NO[2]] == 0.95), cex=1)
text(3, 1, expression(italic(p-value) == 3.78e-33), cex = 0.6)
no2corr2 <- rmcorr(id,log_vest_NO2, log_CDPHE_NO2_mean, daps)
no2corr2
plot(no2corr2, overall = TRUE, palette = pal, overall.col = 'black',lty = 3, xlab = expression(paste("Wearable" , ~ NO[2])), ylab = expression(paste("CDPHE" , ~ NO[2])), main= expression(paste("Correlations between CDPHE and Wearable" , ~ NO[2])))
text(0,.95, expression(bold(rho)[NO[2]] == 0.25), cex=1)
text(0, .92, expression(italic(p-value) == 0.046), cex = 0.6)
plot(no2corr2, overall = TRUE, palette = pal, overall.col = 'black',lty = 3, xlab = expression(paste("Wearable" , ~ NO[2])), ylab = expression(paste("CDPHE" , ~ NO[2])), main= expression(paste("Correlations between CDPHE and Wearable" , ~ NO[2])))
text(0,3.2, expression(bold(rho)[NO[2]] == 0.25), cex=1)
text(0, 3.1, expression(italic(p-value) == 0.046), cex = 0.6)
no2corr3 <- rmcorr(id, log_stat_NO2, log_CDPHE_NO2_mean, daps)
no2corr3
plot(no2corr3, overall = TRUE, palette = pal, overall.col = 'black',lty = 3, xlab = expression(paste("Stationary" , ~ NO[2])), ylab = expression(paste("CDPHE" , ~ NO[2])), main= expression(paste("Correlations between CDPHE and Stationary" , ~ NO[2])))
text(0,.95, expression(bold(rho)[NO[2]] == 0.23), cex=1)
text(0, .92, expression(italic(p-value) == 0.07), cex = 0.6)
plot(no2corr3, overall = TRUE, palette = pal, overall.col = 'black',lty = 3, xlab = expression(paste("Stationary" , ~ NO[2])), ylab = expression(paste("CDPHE" , ~ NO[2])), main= expression(paste("Correlations between CDPHE and Stationary" , ~ NO[2])))
text(0,3.23, expression(bold(rho)[NO[2]] == 0.23), cex=1)
text(0, 3.19, expression(italic(p-value) == 0.07), cex = 0.6)
plot(no2corr3, overall = TRUE, palette = pal, overall.col = 'black',lty = 3, xlab = expression(paste("Stationary" , ~ NO[2])), ylab = expression(paste("CDPHE" , ~ NO[2])), main= expression(paste("Correlations between CDPHE and Stationary" , ~ NO[2])))
text(0,3.23, expression(bold(rho)[NO[2]] == 0.23), cex=1)
text(0, 3.17, expression(italic(p-value) == 0.07), cex = 0.6)
c <- ggplot(daps)
c +
geom_point(aes(log_vest_NO2, log_stat_NO2), color = "red1", shape =17)+
geom_smooth(aes(log_vest_NO2, log_stat_NO2), color = "red1", method="lm", linetype = "dotdash")+
geom_point(aes(log_vest_NO2, log_CDPHE_NO2_mean),color= "mediumblue", shape = 19) +
geom_smooth(aes(log_vest_NO2, log_CDPHE_NO2_mean), color = "mediumblue", method ="lm", linetype= "solid") +
annotate(geom="text", x=0.25, y=4.5, label="CDPHE Mean vs. Wearable Monitor, \n corr = 0.25, p=0.05",
color="mediumblue", fontface="bold")+
annotate(geom="text", x=2, y=0, label="Stationary vs. Wearable Monitor , \n corr = 0.95, p=3.78e-33",
color="red1", fontface="bold")+
xlab(expression(paste("Wearable" , ~ log(NO[2])))) +
ylab(expression( log(NO[2])))+
labs(title = "Relative Correlation with Wearable Monitor")+
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+
theme(plot.title=element_text( face="bold", size=15)) +
theme(text = element_text(size = 15, color= "black"))
c <- ggplot(daps)
c +
geom_point(aes(log_vest_NO2, log_stat_NO2), color = "red1", shape =17)+
geom_smooth(aes(log_vest_NO2, log_stat_NO2), color = "red1", method="lm", linetype = "dotdash")+
geom_point(aes(log_vest_NO2, log_CDPHE_NO2_mean),color= "mediumblue", shape = 19) +
geom_smooth(aes(log_vest_NO2, log_CDPHE_NO2_mean), color = "mediumblue", method ="lm", linetype= "solid") +
annotate(geom="text", x=0.25, y=4, label="CDPHE Mean vs. Wearable Monitor, \n corr = 0.25, p=0.05",
color="mediumblue", fontface="bold")+
annotate(geom="text", x=2, y=0, label="Stationary vs. Wearable Monitor , \n corr = 0.95, p=3.78e-33",
color="red1", fontface="bold")+
xlab(expression(paste("Wearable" , ~ log(NO[2])))) +
ylab(expression( log(NO[2])))+
labs(title = "Relative Correlation with Wearable Monitor")+
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+
theme(plot.title=element_text( face="bold", size=15)) +
theme(text = element_text(size = 15, color= "black"))
c <- ggplot(daps)
c +
geom_point(aes(exp(log_vest_NO2), exp(log_stat_NO2)), color = "red1", shape =17)+
geom_smooth(aes(exp(log_vest_NO2), exp(log_stat_NO2)), color = "red1", method="lm", linetype = "dotdash")+
geom_point(aes(exp(log_vest_NO2), exp(log_CDPHE_NO2_mean)),color= "mediumblue", shape = 19) +
geom_smooth(aes(exp(log_vest_NO2), exp(log_CDPHE_NO2_mean)), color = "mediumblue", method ="lm", linetype= "solid") +
annotate(geom="text",  x=30, y=0, label="CDPHE Mean vs. Wearable NO2, \n corr = 0.25, p=0.05",
color="mediumblue", fontface="bold")+
annotate(geom="text", x=40, y=90, label="Stationary vs. Wearable NO2, \n corr = 0.95, p=3.78e-33",
color="red1", fontface="bold")+
xlab(expression(paste("Wearable" , ~ NO[2]))) +
ylab(expression(NO[2]))+
labs(title = "Relative Correlation with Wearable Monitor")+
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+
theme(plot.title=element_text(face="bold", size=15)) +
theme(text = element_text(size = 15, color= "black"))
c <- ggplot(daps)
c +
geom_point(aes(exp(log_vest_NO2), exp(log_stat_NO2)), color = "red1", shape =17)+
geom_smooth(aes(exp(log_vest_NO2), exp(log_stat_NO2)), color = "red1", method="lm", linetype = "dotdash")+
geom_point(aes(exp(log_vest_NO2), exp(log_CDPHE_NO2_mean)),color= "mediumblue", shape = 19) +
geom_smooth(aes(exp(log_vest_NO2), exp(log_CDPHE_NO2_mean)), color = "mediumblue", method ="lm", linetype= "solid") +
annotate(geom="text",  x=30, y=0, label="CDPHE Mean vs. Wearable NO2, \n corr = 0.25, p=0.05",
color="mediumblue", fontface="bold")+
annotate(geom="text", x=25, y=75, label="Stationary vs. Wearable NO2, \n corr = 0.95, p=3.78e-33",
color="red1", fontface="bold")+
xlab(expression(paste("Wearable" , ~ NO[2]))) +
ylab(expression(NO[2]))+
labs(title = "Relative Correlation with Wearable Monitor")+
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+
theme(plot.title=element_text(face="bold", size=15)) +
theme(text = element_text(size = 15, color= "black"))
c <- ggplot(daps)
c +
geom_point(aes(exp(log_vest_NO2), exp(log_stat_NO2)), color = "red1", shape =17)+
geom_smooth(aes(exp(log_vest_NO2), exp(log_stat_NO2)), color = "red1", method="lm", linetype = "dotdash")+
geom_point(aes(exp(log_vest_NO2), exp(log_CDPHE_NO2_mean)),color= "mediumblue", shape = 19) +
geom_smooth(aes(exp(log_vest_NO2), exp(log_CDPHE_NO2_mean)), color = "mediumblue", method ="lm", linetype= "solid") +
annotate(geom="text",  x=30, y=0, label="CDPHE Mean vs. Wearable NO2, \n corr = 0.25, p=0.05",
color="mediumblue", fontface="bold")+
annotate(geom="text", x=25, y=50, label="Stationary vs. Wearable NO2, \n corr = 0.95, p=3.78e-33",
color="red1", fontface="bold")+
xlab(expression(paste("Wearable" , ~ NO[2]))) +
ylab(expression(NO[2]))+
labs(title = "Relative Correlation with Wearable Monitor")+
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+
theme(plot.title=element_text(face="bold", size=15)) +
theme(text = element_text(size = 15, color= "black"))
c <- ggplot(daps)
c +
geom_point(aes(exp(log_vest_NO2), exp(log_stat_NO2)), color = "red1", shape =17)+
geom_smooth(aes(exp(log_vest_NO2), exp(log_stat_NO2)), color = "red1", method="lm", linetype = "dotdash")+
geom_point(aes(exp(log_vest_NO2), exp(log_CDPHE_NO2_mean)),color= "mediumblue", shape = 19) +
geom_smooth(aes(exp(log_vest_NO2), exp(log_CDPHE_NO2_mean)), color = "mediumblue", method ="lm", linetype= "solid") +
annotate(geom="text",  x=30, y=0, label="CDPHE Mean vs. Wearable NO2, \n corr = 0.25, p=0.05",
color="mediumblue", fontface="bold")+
annotate(geom="text", x=25, y=45, label="Stationary vs. Wearable NO2, \n corr = 0.95, p=3.78e-33",
color="red1", fontface="bold")+
xlab(expression(paste("Wearable" , ~ NO[2]))) +
ylab(expression(NO[2]))+
labs(title = "Relative Correlation with Wearable Monitor")+
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+
theme(plot.title=element_text(face="bold", size=15)) +
theme(text = element_text(size = 15, color= "black"))
c <- ggplot(daps)
c +
geom_point(aes(exp(log_vest_NO2), exp(log_stat_NO2)), color = "red1", shape =17)+
geom_smooth(aes(exp(log_vest_NO2), exp(log_stat_NO2)), color = "red1", method="lm", linetype = "dotdash")+
geom_point(aes(exp(log_vest_NO2), exp(log_CDPHE_NO2_mean)),color= "mediumblue", shape = 19) +
geom_smooth(aes(exp(log_vest_NO2), exp(log_CDPHE_NO2_mean)), color = "mediumblue", method ="lm", linetype= "solid") +
annotate(geom="text",  x=30, y=5, label="CDPHE Mean vs. Wearable NO2, \n corr = 0.25, p=0.05",
color="mediumblue", fontface="bold")+
annotate(geom="text", x=25, y=45, label="Stationary vs. Wearable NO2, \n corr = 0.95, p=3.78e-33",
color="red1", fontface="bold")+
xlab(expression(paste("Wearable" , ~ NO[2]))) +
ylab(expression(NO[2]))+
labs(title = "Relative Correlation with Wearable Monitor")+
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+
theme(plot.title=element_text(face="bold", size=15)) +
theme(text = element_text(size = 15, color= "black"))
#correlation of glucans with endotoxins
glendocorr3 <- cor.test(daps$gluc_m3, log(daps$endo_m3), method="pearson")
glendocorr3
glendocorr2 <- lm(daps$gluc_m3 ~ log(daps$endo_m3), data=daps)
plot(log(daps$endo_m3),daps$gluc_m3 , col="blue", lty= 3, pch=19, xlab=("Log(Endotoxin) Value"), ylab = ("Glucan Value"), main= ("Correlations between Glucans and Endotoxins"))
abline(glendocorr2, col="black", lty=2, lwd=3)
text(-1, 400, expression(bold(rho) == 0.51), cex=1)
text(-1, 370, expression(italic(p-value) == 0.0006), cex = 0.7)
glendocorr3
#correlation of glucans with endotoxins
glendocorr3 <- cor.test(daps$gluc_m3, log(daps$endo_m3), method="pearson")
glendocorr3
glendocorr2 <- lm(daps$gluc_m3 ~ log(daps$endo_m3), data=daps)
plot(log(daps$endo_m3),daps$gluc_m3 , col="blue", lty= 3, pch=19, xlab=("Log(Endotoxin) Value"), ylab = ("Glucan Value"), main= ("Correlations between Glucans and Endotoxins"))
abline(glendocorr2, col="black", lty=2, lwd=3)
text(-1, 400, expression(bold(rho) == 0.59), cex=1)
text(-1, 370, expression(italic(p-value) == 0.0002), cex = 0.7)
library(plyr)
levels(o3$type)[levels(o3$type)=="cdphe_mean"] <- "CDPHE"
library(lme4)
library(lmtest)
library(dplyr)
library(readxl)
library(utils)
library(knitr)
library(ggplot2)
library(plyr)
library(lmerTest)
library(reshape2)
library(stargazer)
library(rmcorr)
library(RColorBrewer)
#### only run this once so that the data sets don't get mixed up ####
names(daps) #find the right columns
pollution <- daps[,c(1:3, 27:40, 56:61)] #subset daps to only pollution data for simplification
names(pollution) #check that we have the right names
id <- daps$id
visit <- daps$visit
season <- daps$season
##### PM10 #####
wearable <- exp(daps$log_vest_pm10)
stationary <- exp(daps$log_msp_pm10)
cdphe_mean <- (daps$CDPHE_PM10_mean)
cdphe_max <- exp(daps$log_CDPHE_PM10_max)
PM10 <- as.data.frame(cbind(id, visit, season, wearable, stationary, cdphe_mean, cdphe_max))
pm10 <- melt(PM10, id.vars = c("id", "visit", "season"), measure.vars = c( "wearable", "stationary","cdphe_mean","cdphe_max"), variable.name = "type", value.name = "PM10",
factorsAsStrings = TRUE)
names(pm10) <- c("id", "visit", "season", "type", "PM10")
#Understanding the mean bias and variance between the wearable (our "truth") and the two other possible monitors.
#Mean Bias of the CDPHE MEAN
bias_cdphe <-mean(mean(cdphe_mean, na.rm=TRUE) - wearable, na.rm=TRUE)
#Mean Variance of the CDPHE MEAN:
#Mean of the Sample Squared:
ss <- mean(cdphe_mean*cdphe_mean, na.rm=TRUE)
#Mean of the Squared Sample:
ess <-(mean(cdphe_mean, na.rm=TRUE)*mean(cdphe_mean, na.rm=TRUE))
mvar_cdphe <- ss-ess
var_cdphe <- var(cdphe_mean, na.rm=TRUE)
#Mean Bias of the Stationary Monitor
bias_stat <-mean(mean(stationary, na.rm=TRUE)-wearable, na.rm=TRUE)
#Mean Variance of the Stationary Monitor
#Mean of the Sample Squared:
ss <- mean(stationary*stationary, na.rm=TRUE)
#Mean of the Squared Sample:
ess <-(mean(stationary, na.rm=TRUE)*mean(stationary, na.rm=TRUE))
mvar_stat <- ss-ess
var_stat <- var(stationary, na.rm=TRUE)
#then, we repeat the means of the stationary and the cdphe across the length of the wearable values
mean_stat <- rep((mean(stationary, na.rm=TRUE)), length(wearable))
mean_cdphe <- rep((mean(cdphe_mean, na.rm=TRUE)), length(wearable))
#and create a new data frame comparing the stationary/cdphe means to each value of the wearable.
dat2 <- as.data.frame(cbind(wearable, mean_stat, mean_cdphe))
#make two vectors of the bias, the mean variance, and the variance of the cdphe and the stationary respectively to print
CDPHE_VAL <- c(bias_cdphe, mvar_cdphe, var_cdphe)
STAT_VAL <- c(bias_stat, mvar_stat, var_stat)
#### NO2 #####
wearable <- exp(daps$log_vest_NO2)
stationary <- exp(daps$log_stat_NO2)
cdphe_mean <- exp(daps$log_CDPHE_NO2_mean)
cdphe_max <- exp(daps$log_CDPHE_NO2_max)
NO2 <- as.data.frame(cbind(id, visit, season, wearable, stationary, cdphe_mean, cdphe_max))
no2 <- melt(NO2, id.vars = c("id", "visit", "season"), measure.vars = c( "wearable", "stationary","cdphe_mean","cdphe_max"),
variable.name = "type", value.name = "NO2",
factorsAsStrings = TRUE)
names(no2) <- c("id", "visit", "season", "type", "NO2")
#Mean Bias of the CDPHE MEAN
bias_cdphe <- mean(mean(cdphe_mean, na.rm=TRUE) - wearable, na.rm=TRUE)
#Mean Variance of the CDPHE MEAN:
#Mean of the Sample Squared:
ss <- mean(cdphe_mean*cdphe_mean, na.rm=TRUE)
#Mean of the Squared Sample:
ess <-(mean(cdphe_mean, na.rm=TRUE)*mean(cdphe_mean, na.rm=TRUE))
mvar_cdphe <- ss-ess
var_cdphe <- var(cdphe_mean, na.rm=TRUE)
#Mean Bias of the Stationary Monitor
bias_stat <- mean(mean(stationary, na.rm=TRUE)-wearable, na.rm=TRUE)
#Mean Variance of the Stationary Monitor
#Mean of the Sample Squared:
ss <- mean(stationary*stationary, na.rm=TRUE)
#Mean of the Squared Sample:
ess <-(mean(stationary, na.rm=TRUE)*mean(stationary, na.rm=TRUE))
mvar_stat <-ss-ess
var_stat <- var(stationary, na.rm=TRUE)
#then, we repeat the means of the stationary and the cdphe across the length of the wearable values
mean_stat <- rep((mean(stationary, na.rm=TRUE)), length(wearable))
mean_cdphe <- rep((mean(cdphe_mean, na.rm=TRUE)), length(wearable))
#and create a new data frame comparing the stationary/cdphe means to each value of the wearable.
dat2 <- as.data.frame(cbind(wearable, mean_stat, mean_cdphe))
#make two vectors of the bias, the mean variance, and the variance of the cdphe and the stationary respectively to print
CDPHE_VAL <- c(bias_cdphe, mvar_cdphe, var_cdphe)
STAT_VAL <- c(bias_stat, mvar_stat, var_stat)
pm10_3 <- subset(pm10, type != "cdphe_max")
pm10_3$season <- as.factor(pm10_3$season)
pm10_2 <- pm10_3
pm10_5 <- pm10_3
#summary(pm10monit2)
pm10_2<- within(pm10_2, type <- relevel(type, ref = "wearable"))
pm10_5<- within(pm10_5, type <- relevel(type, ref = "stationary"))
#with the personal monitor as the reference category
pm10monit <- lmer(PM10 ~ type + season + (1|id), data = pm10_2 )
pm10monit2 <- lmer(PM10 ~ type + season + (1|id), data = pm10_5 )
#summary(pm10monit)
#summary(pm10monit2)
class(pm10monit) <- "lmerMod"
class(pm10monit2) <- "lmerMod"
levels(pm10_5$type )[levels(pm10_5$type )=="cdphe_mean"] <- "CDPHE"
#BOXPLOT
p <- ggplot(pm10_5, aes(type, PM10))
p + geom_boxplot()+
xlab("Monitor")+
ylab("PM10")+
labs(title = "Measured Pollutant by Monitor Type, w/outlier", color ="Type")+
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+
theme(plot.title=element_text(face="bold", size=15)) +theme(text = element_text(size = 15, color= "black"))
#SMOOTHED PLOTS OVER TIME
b <- ggplot(pm10_5, aes(as.numeric(season), PM10, color=type, shape=type))
b + geom_point()+ xlab("Season") + ylab(expression( PM[10]))+ labs(title = "Measured Pollutant by Monitor Type, w/outlier", color ="Type", shape ="Type")+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+theme(plot.title=element_text( face="bold", size=15)) + geom_smooth() + scale_x_continuous(labels=c("1" = "Summer", "2" = "Fall", "3"= "Winter", "4"= "Spring"))+ scale_color_manual(values = c("wearable" = "blue", "stationary" = "limegreen", "CDPHE" = "red")) +theme(text = element_text(size = 15, color= "black"))
#WITH THE OUTLIERS REMOVED
pm10_3 <- subset(pm10_5, pm10_5$PM10 < 200)
b <- ggplot(pm10_3, aes(as.numeric(season), PM10, color=type, shape=type))
b + geom_point()+ xlab("Season") + ylab(expression( PM[10]))+ labs(title = "Measured Pollutant by Monitor Type, w/o outlier", color ="Type", shape ="Type")+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+ scale_color_manual(values = c("wearable" = "blue", "stationary" = "limegreen", "CDPHE" = "red"))+theme(plot.title=element_text( face="bold", size=15)) + geom_smooth() + scale_x_continuous(labels=c("1" = "Summer", "2" = "Fall", "3"= "Winter", "4"= "Spring"))+theme(text = element_text(size = 15, color= "black"))
#### NO2 #####
no2_3 <- subset(no2, type != "cdphe_max")
no2_3$season <- as.factor(no2_3$season)
no2_2 <- no2_3
no2_5 <- no2_3
#summary(pm10monit2)
no2_2<- within(no2_2, type <- relevel(type, ref = "wearable"))
no2_5<- within(no2_5, type <- relevel(type, ref = "stationary"))
#with the personal monitor as the reference category
no2monit <- lmer(NO2 ~ type + season + (1|id), data = no2_2 )
no2monit2 <- lmer(NO2 ~ type + season + (1|id), data = no2_5 )
#summary(no2monit)
#summary(no2monit2)
class(no2monit) <- "lmerMod"
class(no2monit2) <- "lmerMod"
levels(no2_5$type )[levels(no2_5$type )=="cdphe_mean"] <- "CDPHE"
p <- ggplot(no2_5, aes(type, NO2))
p + geom_boxplot()+xlab("Monitor")+ ylab("NO2")+ labs(title = "Measured Pollutant by Monitor Type", color ="Monitor")+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+theme(plot.title=element_text( face="bold", size=15)) +theme(text = element_text(size = 15, color= "black"))
b <- ggplot(no2_5, aes(as.numeric(season), NO2, color=type, shape =type))
b + geom_point()+ xlab("Season") + ylab("NO2")+ labs(title = "Measured Pollutant by Monitor Type, w/outlier", color ="Monitor", shape ="Monitor")+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+theme(plot.title=element_text(face="bold", size=15)) + geom_smooth()+ scale_color_manual(values = c("wearable" = "blue", "stationary" = "limegreen", "CDPHE" = "red")) + scale_x_continuous(labels=c("1" = "Summer", "2" = "Fall", "3"= "Winter", "4"= "Spring"))+theme(text = element_text(size = 15, color= "black"))
b <- ggplot(no2_5, aes(as.numeric(season), NO2, color=type, shape =type))
b + geom_point()+ xlab("Season") + ylab("NO2")+ labs(title = "Measured Pollutant by Monitor Type, w/o outlier", color ="Monitor", shape ="Monitor")+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+theme(plot.title=element_text(face="bold", size=15)) + scale_color_manual(values = c("wearable" = "blue", "stationary" = "limegreen", "CDPHE" = "red"))+ geom_smooth() + scale_x_continuous(labels=c("1" = "Summer", "2" = "Fall", "3"= "Winter", "4"= "Spring"))+theme(text = element_text(size = 15, color= "black"))
library(plyr)
levels(o3$type)[levels(o3$type)=="cdphe_mean"] <- "CDPHE"
#### O3 #####
wearable <- daps$vest_O3
cdphe_mean <- daps$CDPHE_O3_mean
cdphe_max <- daps$CDPHE_O3_max
O3 <- as.data.frame(cbind(id, visit, season, wearable, cdphe_mean, cdphe_max))
o3 <- melt(O3, id.vars = c("id", "visit", "season"), measure.vars = c( "wearable", "cdphe_mean", "cdphe_max"),
variable.name = "type", value.name = "O3",
factorsAsStrings = TRUE)
names(o3) <- c("id", "visit", "season", "type", "O3")
#Mean Bias of the CDPHE MEAN
bias_cdphe <- mean(mean(cdphe_mean, na.rm=TRUE) - wearable, na.rm=TRUE)
#Mean Variance of the CDPHE MEAN:
#Mean of the Sample Squared:
ss <- mean(cdphe_mean*cdphe_mean, na.rm=TRUE)
#Mean of the Squared Sample:
ess <-(mean(cdphe_mean, na.rm=TRUE)*mean(cdphe_mean, na.rm=TRUE))
#mean variance
mvar_cdphe <- ss-ess
#actual variance
var_cdphe <- var(cdphe_mean, na.rm=TRUE)
#make a vector to compare against
mean_cdphe <- rep((mean(cdphe_mean, na.rm=TRUE)), length(wearable))
dat2 <- as.data.frame(cbind(wearable, mean_cdphe))
#make a vector to show the bias, mean variance, and variance next to each other
CDPHE_VAL <- c(bias_cdphe, mvar_cdphe, var_cdphe)
library(plyr)
levels(o3$type)[levels(o3$type)=="cdphe_mean"] <- "CDPHE"
o3_2 <- subset(o3, type != "cdphe_max")
#### O3 #####
o3monit <- lm(O3 ~ as.factor(type), data = o3_2 )
#summary(o3monit)
#the t-tests should give similar results
#t.test(O3$vest, O3$cdphe_mean, paired=TRUE, conf.level=0.95)
p <- ggplot(o3_2, aes(type, O3))
p + geom_boxplot() +xlab("Monitor")+ ylab("Ozone")+ labs(title = "Measured Pollutant by Monitor Type", color ="Type")+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+theme(plot.title=element_text( face="bold", size=15)) +theme(text = element_text(size = 15, color= "black"))
stargazer(o3monit, type="text", style="all", ci=T, ci.level=0.95, summary=FALSE, digits=4, star.cutoffs=c(0.05, 0.01, 0.001), title="Ozone Monitor Differences", covariate.labels=c("CDPHE", "Intercept (Wearable)"))
stargazer(no2monit, type="text", style="all", ci=T, ci.level=0.95, summary=FALSE, digits=4, star.cutoffs=c(0.05, 0.01, 0.001), title="NO2 Monitor Differences,ref = wearable", covariate.labels=c("Stationary", "CDPHE", "Fall", "Winter", "Spring", "Intercept"))
stargazer(pm10monit, type="text", style="all", ci=T, ci.level=0.95, summary=FALSE, digits=4, star.cutoffs=c(0.05, 0.01, 0.001), title="PM10 Monitor Differences,ref = wearable", covariate.labels=c("Stationary", "CDPHE", "Fall", "Winter", "Spring", "Intercept"))
stargazer(pm10monit2, type="text", style="all", ci=T, ci.level=0.95, summary=FALSE, digits=4, star.cutoffs=c(0.05, 0.01, 0.001), title="PM10 Monitor Differences, ref=stationary", covariate.labels=c("Wearable", "CDPHE", "Fall", "Winter", "Spring", "Intercept"))
knitr::opts_chunk$set(echo = TRUE)
setwd("~/Desktop/DAPS_REPO/ReproducibleItemsforDAPS/DATA_RAW")
setwd("~/Desktop/DAPS_REPO/ReproducibleItemsforDAPS/DATA_RAW")
name.gluc <- c("visit", "num", "id", "sample", "pm_wt", "endo_ml", "gluc_ml", "endo_m3", "gluc_m3", "note")
name.demo <- c("id", "visit", "season", "cohort", "X__1", "age", "gender", "race_afam", "X__2","X__3","X__4","X__5","X__6","X__7")
end_gluc <- read_excel("endoglucanfilters_09272018.xlsx", col_names = name.gluc, skip=2)
library(readxl)
library(utils)
library(reshape2)
library(plyr)
setwd("~/Desktop/DAPS_REPO/ReproducibleItemsforDAPS/DATA_RAW")
name.gluc <- c("visit", "num", "id", "sample", "pm_wt", "endo_ml", "gluc_ml", "endo_m3", "gluc_m3", "note")
name.demo <- c("id", "visit", "season", "cohort", "X__1", "age", "gender", "race_afam", "X__2","X__3","X__4","X__5","X__6","X__7")
end_gluc <- read_excel("endoglucanfilters_09272018.xlsx", col_names = name.gluc, skip=2)
demographics <- read_excel("DAPS_Primary_DataSet_180902.xlsx", col_names=name.demo, sheet = "Demographic Predictors", skip=1)
cont_outcomes<- read_excel("DAPS_Primary_DataSet_180902.xlsx", sheet = "Continuous Outcome Variables")
cont_exp_var <- read_excel("DAPS_Primary_DataSet_180902.xlsx", sheet = "Continuous Exposure Variables")
cat_exp_var <- read_excel("DAPS_Primary_DataSet_180902.xlsx", sheet = "Zero-Heavy & Categ. Exposures")
cat_outcomes<- read_excel("DAPS_Primary_DataSet_180902.xlsx", sheet = "Categorical Outcomes")
exacerbation_count <- read_excel("DAPS_Primary_DataSet_180902.xlsx", sheet = "ExacerbationsSinceLastVisit")
newcarbon <- read_excel("DAPS_CarbonData_112818.xlsx")
knitr::opts_chunk$set(echo = TRUE)
output <- read.csv("~/Desktop/DAPS_REPO/ReproducibleItemsforDAPS/REPORTS/DAPS_OUTPUT1.csv", header=TRUE)
names(output)#what are the names of the columns currently?
#create an indicator for any empty rows so that I can delete them
output$ind <-ifelse(is.na(output$Exposure.Coefficient)&is.na(output$VAR.COR),1,0)
#remove the empty rows - there's only 1
output3 <- subset(output, ind == 0) #remove blank lines
#output3 is now workable
#now I want to add in a vector describing the exposure only - not the full model structure
#all of the possible model structures
mod.names <- levels(output3$Model.Structure) #what are the model structures
#split the string of the model names to get rid of the x~
mod.names2 <- sapply(strsplit(mod.names, "[~]"), '[',2) #get rid of the the x and the ~
#for each item in mod.names2, separate the item by the location of the + and then only keep the first item of the stored list
mod.names3 <-lapply(mod.names3 <- strsplit(mod.names2,"+", 2), function(x) { x[1]}) # pull apart everything in between the + and then keep only the first item on the list which is always the exposure value anyway
#trim the white spaces around the exposure names and then unlist them to turn them back into a vector
mod.names4 <- unlist(lapply(mod.names3 <- str_trim(mod.names3), function(x) {x[1]})) #do that again but make it back into a vector and strip the white space
knitr::opts_chunk$set(warning=FALSE, message=FALSE, fig.path='Fig_CoefIQR/')
library(ggplot2)
output <- read.csv("~/Desktop/DAPS_REPO/ReproducibleItemsforDAPS/REPORTS/DAPS_OUTPUT2.csv", header=TRUE)
